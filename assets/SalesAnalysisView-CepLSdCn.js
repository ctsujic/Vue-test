import{_ as V,r as n,o as F,A as I,a as r,b as t,d as g,i as P,w as _,v as k,x as B,F as A,f as M,t as a,g as T,l as U,h as d}from"./index-tvMXVzfh.js";import{$}from"./dataTables.bootstrap5.min-DfwQAa5e.js";const j={class:"container mt-4"},z={class:"row mt-2"},H={class:"col"},K={class:"input-group input-group-sm mb-3"},L={class:"input-group input-group-sm mb-3"},O=["value"],Y={key:0},q={key:0},G={scope:"row"},J={align:"right"},Q={align:"right"},R={align:"right"},W={align:"right"},X={align:"right"},Z={align:"right"},tt={align:"right"},et={key:0},st={class:"table-info"},at={class:"text-end"},lt={class:"text-end"},ot={class:"text-end"},nt={class:"text-end"},ut={class:"text-end"},rt={class:"text-end"},dt={__name:"SalesAnalysisView",setup(it){const i=n(null),y=n(Date.now()),h=()=>{const l=new Date,s=l.getFullYear(),e=String(l.getMonth()+1).padStart(2,"0"),o=String(l.getDate()).padStart(2,"0");return`${s}-${e}-${o}`},p=n(h()),v=n(h()),m=n(""),b=n([]),u=n([]),c=n(!1),f=n(0),x=n(0),w=n(0),N=n(0),D=(l,s)=>(Number(l)||0).toFixed(s),E=async()=>{try{const{data:l}=await T.get("/customers");b.value=l}catch(l){console.error("獲取客戶列表失敗：",l)}},S=async()=>{try{i.value&&(i.value.destroy(),i.value=null),y.value=Date.now();const{data:l}=await T.post("/salesanalysis",{s_date:p.value,e_date:v.value,c_id:m.value});u.value=l.details,f.value=l.summary.總銷貨金額,x.value=l.summary.總進貨金額,w.value=l.summary.其他支出額,N.value=l.summary.本期總淨利,c.value=!0,await U();const s=document.getElementById("salesTable");c.value&&u.value.length>0&&s&&(i.value=$("#salesTable").DataTable({dom:"lrtip",ordering:!0,order:[],paging:!1,info:!1,columns:[{data:null,orderable:!1},{data:"P_NAME"},{data:"數量",type:"num"},{data:"金額",type:"num"},{data:"手續費",type:"num"},{data:"淨利",type:"num"},{data:"平均成本",type:"num"},{data:"毛利",type:"num"},{data:"庫存",orderable:!1}],columnDefs:[{targets:0,render:(e,o,ct,C)=>C.row+1},{targets:1,className:"dt-body-left"},{targets:[2,3,4,5,6,7,8],className:"dt-body-right"},{targets:"_all",className:"dt-head-center"}],language:{url:"/zh-HANT.json"}}))}catch(l){console.error("分析失敗：",l)}};return F(()=>{E()}),I(()=>{i.value&&i.value.destroy()}),(l,s)=>(d(),r("div",j,[s[13]||(s[13]=t("h2",null,"銷售分析",-1)),t("div",z,[t("div",H,[t("form",{onSubmit:P(S,["prevent"])},[t("div",K,[s[3]||(s[3]=t("span",{class:"input-group-text"},"日期區間",-1)),_(t("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=e=>p.value=e),class:"form-control"},null,512),[[k,p.value]]),s[4]||(s[4]=t("span",{class:"input-group-text"},"~",-1)),_(t("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=e=>v.value=e),class:"form-control"},null,512),[[k,v.value]])]),t("div",L,[s[6]||(s[6]=t("span",{class:"input-group-text"},"訂單平台",-1)),_(t("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>m.value=e),class:"form-select"},[s[5]||(s[5]=t("option",{value:""},"請選擇客戶",-1)),(d(!0),r(A,null,M(b.value,e=>(d(),r("option",{key:e.C_ID,value:e.C_ID},a(e.C_NAME),9,O))),128))],512),[[B,m.value]]),t("button",{type:"button",class:"btn btn-outline-info",onClick:S},"開始分析")])],32)])]),c.value?(d(),r("div",Y,[s[7]||(s[7]=t("hr",null,null,-1)),t("p",null,"總銷貨金額："+a(f.value),1),t("p",null,"總進貨金額："+a(x.value),1),t("p",null,"其他支出額："+a(w.value),1),t("p",null,"本期總淨利："+a(N.value),1),s[8]||(s[8]=t("hr",null,null,-1))])):g("",!0),(d(),r("table",{class:"table table-hover",id:"salesTable",key:y.value},[s[12]||(s[12]=t("thead",{class:"table-info"},[t("tr",null,[t("th",{scope:"col"},"#"),t("th",{scope:"col"},"書名"),t("th",{scope:"col"},"數量"),t("th",{scope:"col"},"金額"),t("th",{scope:"col"},"手續費"),t("th",{scope:"col"},"淨利"),t("th",{scope:"col"},"平均成本"),t("th",{scope:"col"},"毛利"),t("th",{scope:"col"},"庫存")])],-1)),t("tbody",null,[c.value?g("",!0):(d(),r("tr",q,s[9]||(s[9]=[t("th",{scope:"row",colspan:"9"},"先選日期區間 → 開始分析",-1)]))),(d(!0),r(A,null,M(u.value,(e,o)=>(d(),r("tr",{key:e.P_NAME+"-"+o},[t("th",G,a(o+1),1),t("td",null,a(e.P_NAME),1),t("td",J,a(e.數量),1),t("td",Q,a(e.金額),1),t("td",R,a(e.手續費),1),t("td",W,a(e.淨利),1),t("td",X,a(D(e.平均成本,3)),1),t("td",Z,a(D(e.毛利,2)),1),t("td",tt,a(e.庫存),1)]))),128))]),c.value?(d(),r("tfoot",et,[t("tr",st,[s[10]||(s[10]=t("td",{colspan:"2"},"合計",-1)),t("td",at,a(u.value.reduce((e,o)=>e+Number(o.數量),0)),1),t("td",lt,a(u.value.reduce((e,o)=>e+Number(o.金額),0)),1),t("td",ot,a(u.value.reduce((e,o)=>e+o.手續費,0)),1),t("td",nt,a(u.value.reduce((e,o)=>e+o.淨利,0)),1),t("td",ut,a(u.value.reduce((e,o)=>e+o.平均成本*o.數量,0).toFixed(2)),1),t("td",rt,a(u.value.reduce((e,o)=>e+o.毛利,0).toFixed(2)),1),s[11]||(s[11]=t("td",null,"　",-1))])])):g("",!0)]))]))}},mt=V(dt,[["__scopeId","data-v-6d800611"]]);export{mt as default};
