import{_ as at,u as dt,r as a,c as P,o as rt,M as ct,a as d,b as t,d as it,e as M,t as l,F as b,f as h,w as Q,v as q,n as I,g as _,h as r,i as G}from"./index-tvMXVzfh.js";const ut={class:"welcome-container"},vt={class:"row mb-4"},_t={class:"col-md-6"},bt={class:"card h-100"},ht={class:"card-header"},mt={class:"mb-0"},pt={class:"badge bg-info"},yt={class:"card-body"},wt={class:"table-responsive"},ft={class:"table"},gt=["onClick"],kt=["onClick"],Lt={class:"col-md-6"},Pt={class:"card h-100"},Mt={class:"card-header"},It={class:"mb-0"},Dt={class:"badge bg-info"},Ct={class:"card-body"},Et={class:"table-responsive"},St={class:"table"},$t=["onClick"],At={class:"row"},Nt={class:"col-md-6"},Ot={class:"card h-100"},Tt={class:"card-header"},xt={class:"mb-0"},Vt={class:"badge bg-warning"},Bt={class:"card-body"},jt={class:"table-responsive"},zt={class:"table"},Ut=["onClick"],Ft={class:"col-md-6"},Kt={class:"card h-100"},Rt={class:"card-header"},Wt={class:"mb-0"},Yt={class:"badge bg-danger"},Zt={class:"card-body"},Qt={class:"table-responsive"},qt={class:"table"},Gt=["onClick"],Ht={key:0,class:"modal fade show",tabindex:"-1",style:{display:"block"}},Jt={class:"modal-dialog"},Xt={class:"modal-content"},ts={class:"modal-header"},ss={class:"modal-title"},es={class:"modal-body"},os={class:"table"},ls={class:"modal fade",id:"locationModal",tabindex:"-1"},ns={class:"modal-dialog"},as={class:"modal-content"},ds={class:"modal-body"},rs={class:"mb-3"},cs={class:"form-label"},is={class:"text-muted"},us={class:"row"},vs={class:"col-md-6 mb-3"},_s={class:"dropdown"},bs=["onMousedown","onMouseover"],hs={class:"col-md-6 mb-3"},ms={class:"dropdown"},ps=["onMousedown","onMouseover"],ys=Object.assign({name:"WelcomeView"},{__name:"WelcomeView",setup(ws){dt();const D=a([]),C=a(!1),E=a(null),S=a([]),$=a([]),A=a([]),y=a([]),w=a(null),i=a({Location_1:"",Location_2:""}),m=a(!1),p=a(!1),f=a([]),g=a([]),k=a(-1),L=a(-1),N=a([]);let O=null;const V=a(0),H=P(()=>D.value.length),J=P(()=>$.value.length),X=P(()=>A.value.length),tt=P(()=>N.value.length),B=async()=>{try{const e=await _.get("/orders/pending");return D.value=e.data,Promise.resolve()}catch(e){return console.error("獲取待取貨訂單失敗：",e),Promise.reject(e)}},j=async()=>{try{const e=await _.get("/products/zero");return $.value=e.data.product,Promise.resolve()}catch(e){return console.error("獲取缺貨商品失敗：",e),Promise.reject(e)}},z=async()=>{try{const e=await _.get("/products/nolocation");return A.value=e.data.data,Promise.resolve()}catch(e){return console.error("獲取待歸位商品失敗：",e),Promise.reject(e)}},st=async()=>{try{const{data:e}=await _.get("/locations");y.value=e}catch(e){console.error("獲取倉儲位置失敗：",e)}},et=async()=>{try{const e=await _.get("/orders/pendingPayment");return N.value=e.data,Promise.resolve()}catch(e){return console.error("獲取待收款訂單失敗：",e),Promise.reject(e)}},U=async e=>{try{const s=await _.get(`/sales/${e}`);E.value=s.data,S.value=s.data.sales_products,C.value=!0}catch(s){console.error("獲取訂單明細失敗：",s)}},F=()=>{C.value=!1,E.value=null,S.value=[]},ot=async(e,s)=>{var n,c;if(confirm(`確定要處理缺貨商品：${s}？`))try{await _.post(`/products/up-zero-product/${e}`),alert("處理成功！"),await j()}catch(v){console.error("處理缺貨商品失敗：",v),alert("處理失敗："+(((c=(n=v.response)==null?void 0:n.data)==null?void 0:c.message)||v.message))}},lt=async e=>{if(!confirm("確定要將此訂單標記為已取貨嗎？"))return;const s=2;try{const{data:n}=await _.post(`/sales/updateStatus/${e}`,{status:s});await B(),console.log("更新訂單狀態成功"),alert("更新訂單『狀態』成功！")}catch(n){console.error("編輯訂單『狀態』失敗：",n.message),alert("編輯訂單『狀態』失敗")}},nt=e=>{w.value=e,i.value={Location_1:e.Location_1||"",Location_2:e.Location_2||""},O.show()},K=e=>{const s=e===1?i.value.Location_1:i.value.Location_2,n=y.value.filter(c=>c.L_NAME.toLowerCase().includes(s.toLowerCase()));e===1?(f.value=n,m.value=!0,k.value=-1):(g.value=n,p.value=!0,L.value=-1)},R=e=>{e===1?(f.value=y.value,m.value=!0):(g.value=y.value,p.value=!0)},W=e=>{setTimeout(()=>{e===1?m.value=!1:p.value=!1},200)},T=(e,s)=>{e===1?(i.value.Location_1=s,m.value=!1):(i.value.Location_2=s,p.value=!1)},Y=(e,s)=>{const n=s===1?k:L,c=s===1?f:g;switch(e.key){case"ArrowDown":e.preventDefault(),n.value<c.value.length-1?n.value++:n.value=0;break;case"ArrowUp":e.preventDefault(),n.value>0?n.value--:n.value=c.value.length-1;break;case"Enter":e.preventDefault();const v=Date.now();v-V.value<300?Z():n.value>-1&&T(s,c.value[n.value].L_NAME),V.value=v;break;case"Escape":e.preventDefault(),s===1?m.value=!1:p.value=!1;break}},Z=async()=>{try{await _.patch(`/products/${w.value.P_ID}`,i.value),alert("更新成功"),O.hide(),await z()}catch(e){console.error("更新倉儲位置失敗：",e),alert("更新失敗")}};return rt(()=>{O=new ct(document.getElementById("locationModal")),st(),B().then(()=>(console.log("尚未取貨訂單載入完成"),new Promise(e=>setTimeout(()=>e(et()),500)))).then(()=>(console.log("尚未收款訂單載入完成"),new Promise(e=>setTimeout(()=>e(j()),500)))).then(()=>(console.log("缺貨中商品載入完成"),new Promise(e=>setTimeout(()=>e(z()),500)))).then(()=>{console.log("待歸位商品載入完成")}).catch(e=>{console.error("資料載入過程發生錯誤：",e)})}),(e,s)=>{var n,c,v;return r(),d("div",ut,[s[24]||(s[24]=t("div",{class:"card mb-4"},[t("div",{class:"card-body text-center"},[t("h2",{class:"display-4 mb-4"},"歡迎使用 C-IO 系統")])],-1)),t("div",vt,[t("div",_t,[t("div",bt,[t("div",ht,[t("h5",mt,[s[10]||(s[10]=M("尚未取貨訂單 ")),t("span",pt,l(H.value),1)])]),t("div",yt,[t("div",wt,[t("table",ft,[s[11]||(s[11]=t("thead",null,[t("tr",null,[t("th",null,"訂單編號"),t("th",null,"客戶"),t("th",null,"金額"),t("th",null,"操作")])],-1)),t("tbody",null,[(r(!0),d(b,null,h(D.value,o=>(r(),d("tr",{key:o.SI_ID},[t("td",null,[t("button",{class:"btn btn-link",onClick:u=>U(o.SI_ID)},l(o.SI_ORDER),9,gt)]),t("td",null,l(o.customer.C_NAME),1),t("td",null,"$ "+l(o.SI_MONEY),1),t("td",null,[t("button",{class:"btn btn-success btn-sm",onClick:u=>lt(o.SI_ID)}," 取貨 ",8,kt)])]))),128))])])])])])]),t("div",Lt,[t("div",Pt,[t("div",Mt,[t("h5",It,[s[12]||(s[12]=M("尚未收款訂單 ")),t("span",Dt,l(tt.value),1)])]),t("div",Ct,[t("div",Et,[t("table",St,[s[13]||(s[13]=t("thead",null,[t("tr",null,[t("th",null,"訂單編號"),t("th",null,"客戶"),t("th",null,"金額")])],-1)),t("tbody",null,[(r(!0),d(b,null,h(N.value,o=>(r(),d("tr",{key:o.SI_ID},[t("td",null,[t("button",{class:"btn btn-link",onClick:u=>U(o.SI_ID)},l(o.SI_ORDER),9,$t)]),t("td",null,l(o.customer.C_NAME),1),t("td",null,"$ "+l(o.SI_MONEY),1)]))),128))])])])])])])]),t("div",At,[t("div",Nt,[t("div",Ot,[t("div",Tt,[t("h5",xt,[s[14]||(s[14]=M("缺貨中商品 ")),t("span",Vt,l(J.value),1)])]),t("div",Bt,[t("div",jt,[t("table",zt,[s[15]||(s[15]=t("thead",null,[t("tr",null,[t("th",null,"書名")])],-1)),t("tbody",null,[(r(!0),d(b,null,h($.value,o=>(r(),d("tr",{key:o.P_ID},[t("td",null,[t("button",{class:"btn btn-link",onClick:u=>ot(o.P_ID,o.P_NAME)},l(o.P_NAME),9,Ut)])]))),128))])])])])])]),t("div",Ft,[t("div",Kt,[t("div",Rt,[t("h5",Wt,[s[16]||(s[16]=M("待歸位商品 ")),t("span",Yt,l(X.value),1)])]),t("div",Zt,[t("div",Qt,[t("table",qt,[s[17]||(s[17]=t("thead",null,[t("tr",null,[t("th",null,"書名"),t("th",null,"數量")])],-1)),t("tbody",null,[(r(!0),d(b,null,h(A.value,o=>(r(),d("tr",{key:o.P_ID},[t("td",null,[t("button",{class:"btn btn-link",onClick:u=>nt(o)},l(o.P_NAME),9,Gt)]),t("td",null,l(o.P_STOCK),1)]))),128))])])])])])])]),C.value?(r(),d("div",Ht,[t("div",Jt,[t("div",Xt,[t("div",ts,[t("h5",ss,"訂單編號："+l((n=E.value)==null?void 0:n.SI_ID),1),t("button",{type:"button",class:"btn-close",onClick:F})]),t("div",es,[t("table",os,[s[18]||(s[18]=t("thead",null,[t("tr",null,[t("th",null,"書名"),t("th",null,"數量"),t("th",null,"單價"),t("th",null,"小計")])],-1)),t("tbody",null,[(r(!0),d(b,null,h(S.value,o=>(r(),d("tr",{key:o.id},[t("td",null,l(o.product.P_NAME),1),t("td",null,l(o.SI_QUANTITY),1),t("td",null,l(o.SI_COST),1),t("td",null,l(o.SI_TOTAL),1)]))),128))])])]),t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary",onClick:F},"關閉")])])])])):it("",!0),t("div",ls,[t("div",ns,[t("div",as,[s[23]||(s[23]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"編輯倉儲位置"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",ds,[t("div",rs,[t("label",cs,"書名："+l((c=w.value)==null?void 0:c.P_NAME),1),s[19]||(s[19]=t("br",null,null,-1)),t("small",is,"條碼："+l((v=w.value)==null?void 0:v.P_NS),1)]),t("div",us,[t("div",vs,[s[20]||(s[20]=t("label",{class:"form-label"},"倉儲位置1",-1)),t("div",_s,[Q(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=o=>i.value.Location_1=o),onInput:s[1]||(s[1]=o=>K(1)),onFocus:s[2]||(s[2]=o=>R(1)),onBlur:s[3]||(s[3]=o=>W(1)),onKeydown:s[4]||(s[4]=o=>Y(o,1))},null,544),[[q,i.value.Location_1]]),t("ul",{class:I(["dropdown-menu w-100",{show:m.value}])},[(r(!0),d(b,null,h(f.value,(o,u)=>(r(),d("li",{key:o.id,class:I({active:u===k.value})},[t("a",{class:"dropdown-item",href:"#",onMousedown:G(x=>T(1,o.L_NAME),["prevent"]),onMouseover:x=>k.value=u},l(o.L_NAME),41,bs)],2))),128))],2)])]),t("div",hs,[s[21]||(s[21]=t("label",{class:"form-label"},"倉儲位置2",-1)),t("div",ms,[Q(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[5]||(s[5]=o=>i.value.Location_2=o),onInput:s[6]||(s[6]=o=>K(2)),onFocus:s[7]||(s[7]=o=>R(2)),onBlur:s[8]||(s[8]=o=>W(2)),onKeydown:s[9]||(s[9]=o=>Y(o,2))},null,544),[[q,i.value.Location_2]]),t("ul",{class:I(["dropdown-menu w-100",{show:p.value}])},[(r(!0),d(b,null,h(g.value,(o,u)=>(r(),d("li",{key:o.id,class:I({active:u===L.value})},[t("a",{class:"dropdown-item",href:"#",onMousedown:G(x=>T(2,o.L_NAME),["prevent"]),onMouseover:x=>L.value=u},l(o.L_NAME),41,ps)],2))),128))],2)])])])]),t("div",{class:"modal-footer"},[s[22]||(s[22]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),t("button",{type:"button",class:"btn btn-primary",onClick:Z},"儲存")])])])])])}}}),gs=at(ys,[["__scopeId","data-v-3a98e240"]]);export{gs as default};
