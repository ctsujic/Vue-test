import{_ as j,r as c,c as S,m as L,o as Q,a as o,b as t,d as $,t as n,e as q,w as x,p as T,F as b,f as y,g as u,h as a}from"./index-tvMXVzfh.js";const z={class:"billing-container"},G={class:"card mb-4"},H={class:"card-body"},J={class:"text-primary"},K={class:"card mb-4"},W={class:"card-header d-flex justify-content-between align-items-center"},X={class:"mb-0"},Z={class:"badge bg-info ms-2"},tt={class:"d-flex align-items-center"},lt={class:"total-amount me-3"},st={class:"text-primary"},et=["disabled"],nt={class:"card-body"},ot={class:"table-responsive"},at={class:"table table-hover"},dt=["value"],ct={class:"card mb-4"},rt={class:"card-body"},ut={class:"table-responsive"},it={class:"table"},_t=["onClick"],vt={class:"card mb-4"},ht={class:"card-body"},bt={class:"table-responsive"},yt={class:"table"},pt=["onClick"],gt={key:0,class:"modal fade show",tabindex:"-1",style:{display:"block"}},mt={class:"modal-dialog"},It={class:"modal-content"},ft={class:"modal-header"},kt={class:"modal-title"},Dt={class:"modal-body"},Bt={class:"table"},wt={key:1,class:"modal fade show",tabindex:"-1",style:{display:"block"}},Ct={class:"modal-dialog"},Pt={class:"modal-content"},Mt={class:"modal-header"},Et={class:"modal-title"},Ot={class:"modal-body"},Nt={class:"table"},St=Object.assign({name:"BillingView"},{__name:"BillingView",setup($t){const B=c(0),w=c([]),p=c(!1),g=c(null),m=c([]),C=c([]),I=c(!1),f=c(null),k=c([]),i=c([]),r=c([]),_=c(!1),D=S(()=>r.value.reduce((e,l)=>e+parseFloat(l.SI_MONEY),0).toFixed(2)),P=async()=>{try{const e=await u.get("/billing/nowMoney");B.value=e.data,console.log("billing=",e)}catch(e){console.error("獲取目前結餘失敗：",e)}},A=async()=>{try{const e=await u.get("/purchases/latest");w.value=e.data}catch(e){console.error("獲取近期進貨紀錄失敗：",e)}},M=async()=>{try{const e=await u.get("/billing/latest");C.value=e.data,console.log("收款紀錄：",e.data)}catch(e){console.error("獲取近期收款紀錄失敗：",e)}},V=async e=>{try{const l=await u.get(`/purchases/${e}`);g.value=l.data,m.value=l.data.purchase_products,p.value=!0}catch(l){console.error("獲取進貨明細失敗：",l)}},Y=async e=>{try{const l=await u.get(`/billing/${e}`);f.value=l.data,k.value=l.data.billing_details,I.value=!0,console.log(l.data)}catch(l){console.error("獲取收款明細失敗：",l)}},E=()=>{p.value=!1,g.value=null,m.value=[]},O=()=>{I.value=!1,f.value=null,k.value=[]},N=async()=>{try{const e=await u.get("/orders/pendingPayment");i.value=e.data}catch(e){console.error("獲取尚未收款訂單失敗：",e)}},F=S(()=>i.value.length),R=()=>{_.value?r.value=[...i.value]:r.value=[]};L(r,e=>{_.value=e.length===i.value.length},{deep:!0});const U=async()=>{var l,v;if(r.value.length===0){alert("請至少選擇一筆訂單");return}const e={orders:r.value.map(d=>({SI_ID:d.SI_ID,C_ID:d.customer.C_ID,B_MONEY:d.SI_MONEY})),total:parseFloat(D.value)};if(console.log("準備送出的收款資料：",e),confirm(`確定要送出這 ${r.value.length} 筆收款資料，總金額 $${D.value} 嗎？`))try{const d=await u.post("/billing",e);console.log("收款成功：",d.data),alert("收款成功！"),await Promise.all([P(),N(),M()]),r.value=[],_.value=!1}catch(d){console.error("收款失敗：",d),alert("收款失敗："+(((v=(l=d.response)==null?void 0:l.data)==null?void 0:v.message)||d.message))}};return Q(()=>{P(),A(),M(),N()}),(e,l)=>{var v,d;return a(),o("div",z,[t("div",G,[l[3]||(l[3]=t("div",{class:"card-header"},[t("h5",{class:"mb-0"},"目前結餘")],-1)),t("div",H,[t("h2",J,"$ "+n(B.value),1)])]),t("div",K,[t("div",W,[t("h5",X,[l[4]||(l[4]=q(" 尚未收款訂單 ")),t("span",Z,n(F.value),1)]),t("div",tt,[t("div",lt,[l[5]||(l[5]=t("strong",null,"勾選金額合計：",-1)),t("span",st,"$ "+n(D.value),1)]),t("button",{class:"btn btn-primary",onClick:U,disabled:r.value.length===0}," 送出收款 ",8,et)])]),t("div",nt,[t("div",ot,[t("table",at,[t("thead",null,[t("tr",null,[t("th",null,[x(t("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":l[0]||(l[0]=s=>_.value=s),onChange:R},null,544),[[T,_.value]])]),l[6]||(l[6]=t("th",null,"原單號",-1)),l[7]||(l[7]=t("th",null,"客戶名稱",-1)),l[8]||(l[8]=t("th",null,"訂單金額",-1)),l[9]||(l[9]=t("th",null,"訂單編號",-1))])]),t("tbody",null,[(a(!0),o(b,null,y(i.value,s=>(a(),o("tr",{key:s.SI_ID},[t("td",null,[x(t("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":l[1]||(l[1]=h=>r.value=h),value:s,onChange:l[2]||(l[2]=(...h)=>e.calculateTotal&&e.calculateTotal(...h))},null,40,dt),[[T,r.value]])]),t("td",null,n(s.SI_ORDER),1),t("td",null,n(s.customer.C_NAME),1),t("td",null,"$ "+n(s.SI_MONEY),1),t("td",null,n(s.SI_ID),1)]))),128))])])])])]),t("div",ct,[l[11]||(l[11]=t("div",{class:"card-header"},[t("h5",{class:"mb-0"},"近期進貨紀錄")],-1)),t("div",rt,[t("div",ut,[t("table",it,[l[10]||(l[10]=t("thead",null,[t("tr",null,[t("th",null,"訂單編號"),t("th",null,"廠商名稱"),t("th",null,"進貨日期"),t("th",null,"進貨金額")])],-1)),t("tbody",null,[(a(!0),o(b,null,y(w.value,s=>(a(),o("tr",{key:s.PI_ID},[t("td",null,[t("button",{class:"btn btn-link",onClick:h=>V(s.PI_ID)},n(s.PI_ID),9,_t)]),t("td",null,n(s.supplier.S_NAME),1),t("td",null,n(s.PI_DATE),1),t("td",null,"$ "+n(s.PI_MONEY),1)]))),128))])])])])]),t("div",vt,[l[13]||(l[13]=t("div",{class:"card-header"},[t("h5",{class:"mb-0"},"近期收款紀錄")],-1)),t("div",ht,[t("div",bt,[t("table",yt,[l[12]||(l[12]=t("thead",null,[t("tr",null,[t("th",null,"收款編號"),t("th",null,"客戶名稱"),t("th",null,"收款日期"),t("th",null,"收款金額")])],-1)),t("tbody",null,[(a(!0),o(b,null,y(C.value,s=>(a(),o("tr",{key:s.B_ID},[t("td",null,[t("button",{class:"btn btn-link",onClick:h=>Y(s.B_ID)},n(s.B_ID),9,pt)]),t("td",null,n(s.customer.C_NAME),1),t("td",null,n(s.B_DATE),1),t("td",null,"$ "+n(s.B_TOTAL),1)]))),128))])])])])]),p.value?(a(),o("div",gt,[t("div",mt,[t("div",It,[t("div",ft,[t("h5",kt,"進貨單號："+n((v=g.value)==null?void 0:v.PI_ID),1),t("button",{type:"button",class:"btn-close",onClick:E})]),t("div",Dt,[t("table",Bt,[l[14]||(l[14]=t("thead",null,[t("tr",null,[t("th",null,"書名"),t("th",null,"數量"),t("th",null,"單價")])],-1)),t("tbody",null,[(a(!0),o(b,null,y(m.value,s=>(a(),o("tr",{key:s.id},[t("td",null,n(s.product.P_NAME),1),t("td",null,n(s.PI_QUANTITY),1),t("td",null,"$ "+n(s.PI_COST),1)]))),128))])])]),t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary",onClick:E},"關閉")])])])])):$("",!0),I.value?(a(),o("div",wt,[t("div",Ct,[t("div",Pt,[t("div",Mt,[t("h5",Et,"收款單號："+n((d=f.value)==null?void 0:d.B_ID),1),t("button",{type:"button",class:"btn-close",onClick:O})]),t("div",Ot,[t("table",Nt,[l[15]||(l[15]=t("thead",null,[t("tr",null,[t("th",null,"訂單編號"),t("th",null,"收款金額"),t("th",null,"收款日期")])],-1)),t("tbody",null,[(a(!0),o(b,null,y(k.value,s=>(a(),o("tr",{key:s.id},[t("td",null,n(s.SI_ID),1),t("td",null,"$ "+n(s.B_MONEY),1),t("td",null,n(s.B_DATE),1)]))),128))])])]),t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary",onClick:O},"關閉")])])])])):$("",!0)])}}}),Tt=j(St,[["__scopeId","data-v-5ba665e1"]]);export{Tt as default};
